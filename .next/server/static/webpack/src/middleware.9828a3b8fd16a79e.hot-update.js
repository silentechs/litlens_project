"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   getCurrentUser: () => (/* binding */ getCurrentUser),\n/* harmony export */   handlers: () => (/* binding */ handlers),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   requireAdmin: () => (/* binding */ requireAdmin),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth),\n/* harmony export */   requireRole: () => (/* binding */ requireRole),\n/* harmony export */   signIn: () => (/* binding */ signIn),\n/* harmony export */   signOut: () => (/* binding */ signOut),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(middleware)/./node_modules/next-auth/index.js\");\n/* harmony import */ var _auth_prisma_adapter__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @auth/prisma-adapter */ \"(middleware)/./node_modules/@auth/prisma-adapter/index.js\");\n/* harmony import */ var next_auth_providers_resend__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth/providers/resend */ \"(middleware)/./node_modules/next-auth/providers/resend.js\");\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(middleware)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./db */ \"(middleware)/./src/lib/db.ts\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! zod */ \"(middleware)/./node_modules/zod/v3/types.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! bcryptjs */ \"(middleware)/./node_modules/bcryptjs/index.js\");\n\n\n\n\n\n\n\n// Credentials validation schema\nconst credentialsSchema = zod__WEBPACK_IMPORTED_MODULE_6__.object({\n    email: zod__WEBPACK_IMPORTED_MODULE_6__.string().email(\"Invalid email address\"),\n    password: zod__WEBPACK_IMPORTED_MODULE_6__.string().min(8, \"Password must be at least 8 characters\")\n});\nconst { handlers, auth, signIn, signOut } = (0,next_auth__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n    adapter: (0,_auth_prisma_adapter__WEBPACK_IMPORTED_MODULE_1__.PrismaAdapter)(_db__WEBPACK_IMPORTED_MODULE_4__.db),\n    providers: [\n        // Magic Link via Resend\n        (0,next_auth_providers_resend__WEBPACK_IMPORTED_MODULE_2__[\"default\"])({\n            apiKey: process.env.RESEND_API_KEY,\n            from: process.env.FROM_EMAIL || \"LitLens <noreply@litlens.com>\"\n        }),\n        // Email/Password credentials\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_3__[\"default\"])({\n            id: \"credentials\",\n            name: \"Email & Password\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                try {\n                    const parsed = credentialsSchema.safeParse(credentials);\n                    if (!parsed.success) {\n                        console.log(\"[Auth] Invalid credentials format:\", parsed.error.errors);\n                        return null;\n                    }\n                    const { email, password } = parsed.data;\n                    // Find user with password\n                    const user = await _db__WEBPACK_IMPORTED_MODULE_4__.db.user.findUnique({\n                        where: {\n                            email: email.toLowerCase()\n                        },\n                        select: {\n                            id: true,\n                            email: true,\n                            name: true,\n                            image: true,\n                            password: true,\n                            role: true,\n                            emailVerified: true\n                        }\n                    });\n                    // User not found or no password set\n                    if (!user) {\n                        console.log(\"[Auth] User not found:\", email);\n                        return null;\n                    }\n                    if (!user.password) {\n                        console.log(\"[Auth] User has no password set (magic link user):\", email);\n                        return null;\n                    }\n                    // Verify password\n                    const isValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_5__[\"default\"].compare(password, user.password);\n                    if (!isValid) {\n                        console.log(\"[Auth] Invalid password for:\", email);\n                        return null;\n                    }\n                    console.log(\"[Auth] Login successful for:\", email);\n                    // Return user data (without password)\n                    return {\n                        id: user.id,\n                        email: user.email,\n                        name: user.name,\n                        image: user.image,\n                        role: user.role,\n                        emailVerified: user.emailVerified\n                    };\n                } catch (error) {\n                    console.error(\"[Auth] Authorization error:\", error);\n                    return null;\n                }\n            }\n        })\n    ],\n    session: {\n        strategy: \"jwt\",\n        maxAge: 30 * 24 * 60 * 60\n    },\n    pages: {\n        signIn: \"/login\",\n        signOut: \"/login\",\n        error: \"/login\",\n        verifyRequest: \"/verify-request\",\n        newUser: \"/onboarding\"\n    },\n    callbacks: {\n        async jwt ({ token, user, trigger, session }) {\n            // Initial sign in\n            if (user) {\n                token.id = user.id;\n                token.role = user.role || \"USER\";\n            }\n            // Fetch fresh user data on session update\n            if (trigger === \"update\" && session) {\n                const freshUser = await _db__WEBPACK_IMPORTED_MODULE_4__.db.user.findUnique({\n                    where: {\n                        id: token.id\n                    },\n                    select: {\n                        id: true,\n                        name: true,\n                        email: true,\n                        image: true,\n                        role: true\n                    }\n                });\n                if (freshUser) {\n                    token.name = freshUser.name;\n                    token.email = freshUser.email;\n                    token.picture = freshUser.image;\n                    token.role = freshUser.role;\n                }\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (token && session.user) {\n                session.user.id = token.id;\n                session.user.role = token.role;\n            }\n            return session;\n        },\n        async signIn ({ user, account }) {\n            // For credentials provider, always allow (password already verified)\n            if (account?.provider === \"credentials\") {\n                return true;\n            }\n            // For magic link, check email exists\n            if (!user?.email) {\n                return false;\n            }\n            return true;\n        }\n    },\n    events: {\n        async signIn ({ user, account, isNewUser }) {\n            // Log sign in activity\n            if (user.id) {\n                await _db__WEBPACK_IMPORTED_MODULE_4__.db.activity.create({\n                    data: {\n                        userId: user.id,\n                        type: \"PROJECT_CREATED\",\n                        description: `User signed in via ${account?.provider || \"credentials\"}`,\n                        metadata: {\n                            provider: account?.provider || \"credentials\",\n                            isNewUser\n                        }\n                    }\n                }).catch(console.error);\n            }\n        },\n        async createUser ({ user }) {\n            // Create default preferences for new users\n            if (user.id) {\n                await _db__WEBPACK_IMPORTED_MODULE_4__.db.userPreferences.create({\n                    data: {\n                        userId: user.id\n                    }\n                }).catch(console.error);\n            }\n        }\n    },\n    secret: process.env.AUTH_SECRET,\n    debug: \"development\" === \"development\"\n});\n// ============== PASSWORD UTILITIES ==============\n/**\n * Hash a password using bcrypt\n */ async function hashPassword(password) {\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_5__[\"default\"].hash(password, 12);\n}\n/**\n * Verify a password against a hash\n */ async function verifyPassword(password, hash) {\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_5__[\"default\"].compare(password, hash);\n}\n// ============== AUTH HELPERS ==============\n/**\n * Get current session (for server components)\n */ async function getCurrentUser() {\n    const session = await auth();\n    return session?.user;\n}\n/**\n * Require authentication (throws if not authenticated)\n */ async function requireAuth() {\n    const user = await getCurrentUser();\n    if (!user) {\n        throw new Error(\"Unauthorized\");\n    }\n    return user;\n}\n/**\n * Check if user has a specific role\n */ async function requireRole(roles) {\n    const user = await requireAuth();\n    if (!roles.includes(user.role || \"\")) {\n        throw new Error(\"Forbidden\");\n    }\n    return user;\n}\n/**\n * Check if user is admin\n */ async function requireAdmin() {\n    return requireRole([\n        \"ADMIN\"\n    ]);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL2xpYi9hdXRoLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQWlDO0FBQ29CO0FBQ0w7QUFDVTtBQUNoQztBQUNGO0FBQ007QUFFOUIsZ0NBQWdDO0FBQ2hDLE1BQU1PLG9CQUFvQkYsdUNBQVEsQ0FBQztJQUNqQ0ksT0FBT0osdUNBQVEsR0FBR0ksS0FBSyxDQUFDO0lBQ3hCRSxVQUFVTix1Q0FBUSxHQUFHTyxHQUFHLENBQUMsR0FBRztBQUM5QjtBQUVPLE1BQU0sRUFBRUMsUUFBUSxFQUFFQyxJQUFJLEVBQUVDLE1BQU0sRUFBRUMsT0FBTyxFQUFFLEdBQUdoQixxREFBUUEsQ0FBQztJQUMxRGlCLFNBQVNoQixtRUFBYUEsQ0FBQ0csbUNBQUVBO0lBRXpCYyxXQUFXO1FBQ1Qsd0JBQXdCO1FBQ3hCaEIsc0VBQU1BLENBQUM7WUFDTGlCLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztZQUNsQ0MsTUFBTUgsUUFBUUMsR0FBRyxDQUFDRyxVQUFVLElBQUk7UUFDbEM7UUFFQSw2QkFBNkI7UUFDN0JyQiwyRUFBV0EsQ0FBQztZQUNWc0IsSUFBSTtZQUNKQyxNQUFNO1lBQ05DLGFBQWE7Z0JBQ1hsQixPQUFPO29CQUFFbUIsT0FBTztvQkFBU0MsTUFBTTtnQkFBUTtnQkFDdkNsQixVQUFVO29CQUFFaUIsT0FBTztvQkFBWUMsTUFBTTtnQkFBVztZQUNsRDtZQUNBLE1BQU1DLFdBQVVILFdBQVc7Z0JBQ3pCLElBQUk7b0JBQ0YsTUFBTUksU0FBU3hCLGtCQUFrQnlCLFNBQVMsQ0FBQ0w7b0JBQzNDLElBQUksQ0FBQ0ksT0FBT0UsT0FBTyxFQUFFO3dCQUNuQkMsUUFBUUMsR0FBRyxDQUFDLHNDQUFzQ0osT0FBT0ssS0FBSyxDQUFDQyxNQUFNO3dCQUNyRSxPQUFPO29CQUNUO29CQUVBLE1BQU0sRUFBRTVCLEtBQUssRUFBRUUsUUFBUSxFQUFFLEdBQUdvQixPQUFPTyxJQUFJO29CQUV2QywwQkFBMEI7b0JBQzFCLE1BQU1DLE9BQU8sTUFBTW5DLG1DQUFFQSxDQUFDbUMsSUFBSSxDQUFDQyxVQUFVLENBQUM7d0JBQ3BDQyxPQUFPOzRCQUFFaEMsT0FBT0EsTUFBTWlDLFdBQVc7d0JBQUc7d0JBQ3BDQyxRQUFROzRCQUNObEIsSUFBSTs0QkFDSmhCLE9BQU87NEJBQ1BpQixNQUFNOzRCQUNOa0IsT0FBTzs0QkFDUGpDLFVBQVU7NEJBQ1ZrQyxNQUFNOzRCQUNOQyxlQUFlO3dCQUNqQjtvQkFDRjtvQkFFQSxvQ0FBb0M7b0JBQ3BDLElBQUksQ0FBQ1AsTUFBTTt3QkFDVEwsUUFBUUMsR0FBRyxDQUFDLDBCQUEwQjFCO3dCQUN0QyxPQUFPO29CQUNUO29CQUVBLElBQUksQ0FBQzhCLEtBQUs1QixRQUFRLEVBQUU7d0JBQ2xCdUIsUUFBUUMsR0FBRyxDQUFDLHNEQUFzRDFCO3dCQUNsRSxPQUFPO29CQUNUO29CQUVBLGtCQUFrQjtvQkFDbEIsTUFBTXNDLFVBQVUsTUFBTXpDLHdEQUFjLENBQUNLLFVBQVU0QixLQUFLNUIsUUFBUTtvQkFDNUQsSUFBSSxDQUFDb0MsU0FBUzt3QkFDWmIsUUFBUUMsR0FBRyxDQUFDLGdDQUFnQzFCO3dCQUM1QyxPQUFPO29CQUNUO29CQUVBeUIsUUFBUUMsR0FBRyxDQUFDLGdDQUFnQzFCO29CQUU1QyxzQ0FBc0M7b0JBQ3RDLE9BQU87d0JBQ0xnQixJQUFJYyxLQUFLZCxFQUFFO3dCQUNYaEIsT0FBTzhCLEtBQUs5QixLQUFLO3dCQUNqQmlCLE1BQU1hLEtBQUtiLElBQUk7d0JBQ2ZrQixPQUFPTCxLQUFLSyxLQUFLO3dCQUNqQkMsTUFBTU4sS0FBS00sSUFBSTt3QkFDZkMsZUFBZVAsS0FBS08sYUFBYTtvQkFDbkM7Z0JBQ0YsRUFBRSxPQUFPVixPQUFPO29CQUNkRixRQUFRRSxLQUFLLENBQUMsK0JBQStCQTtvQkFDN0MsT0FBTztnQkFDVDtZQUNGO1FBQ0Y7S0FDRDtJQUVEYSxTQUFTO1FBQ1BDLFVBQVU7UUFDVkMsUUFBUSxLQUFLLEtBQUssS0FBSztJQUN6QjtJQUVBQyxPQUFPO1FBQ0xyQyxRQUFRO1FBQ1JDLFNBQVM7UUFDVG9CLE9BQU87UUFDUGlCLGVBQWU7UUFDZkMsU0FBUztJQUNYO0lBRUFDLFdBQVc7UUFDVCxNQUFNQyxLQUFJLEVBQUVDLEtBQUssRUFBRWxCLElBQUksRUFBRW1CLE9BQU8sRUFBRVQsT0FBTyxFQUFFO1lBQ3pDLGtCQUFrQjtZQUNsQixJQUFJVixNQUFNO2dCQUNSa0IsTUFBTWhDLEVBQUUsR0FBR2MsS0FBS2QsRUFBRTtnQkFDbEJnQyxNQUFNWixJQUFJLEdBQUcsS0FBNEJBLElBQUksSUFBSTtZQUNuRDtZQUVBLDBDQUEwQztZQUMxQyxJQUFJYSxZQUFZLFlBQVlULFNBQVM7Z0JBQ25DLE1BQU1VLFlBQVksTUFBTXZELG1DQUFFQSxDQUFDbUMsSUFBSSxDQUFDQyxVQUFVLENBQUM7b0JBQ3pDQyxPQUFPO3dCQUFFaEIsSUFBSWdDLE1BQU1oQyxFQUFFO29CQUFXO29CQUNoQ2tCLFFBQVE7d0JBQ05sQixJQUFJO3dCQUNKQyxNQUFNO3dCQUNOakIsT0FBTzt3QkFDUG1DLE9BQU87d0JBQ1BDLE1BQU07b0JBQ1I7Z0JBQ0Y7Z0JBRUEsSUFBSWMsV0FBVztvQkFDYkYsTUFBTS9CLElBQUksR0FBR2lDLFVBQVVqQyxJQUFJO29CQUMzQitCLE1BQU1oRCxLQUFLLEdBQUdrRCxVQUFVbEQsS0FBSztvQkFDN0JnRCxNQUFNRyxPQUFPLEdBQUdELFVBQVVmLEtBQUs7b0JBQy9CYSxNQUFNWixJQUFJLEdBQUdjLFVBQVVkLElBQUk7Z0JBQzdCO1lBQ0Y7WUFFQSxPQUFPWTtRQUNUO1FBRUEsTUFBTVIsU0FBUSxFQUFFQSxPQUFPLEVBQUVRLEtBQUssRUFBRTtZQUM5QixJQUFJQSxTQUFTUixRQUFRVixJQUFJLEVBQUU7Z0JBQ3pCVSxRQUFRVixJQUFJLENBQUNkLEVBQUUsR0FBR2dDLE1BQU1oQyxFQUFFO2dCQUMxQndCLFFBQVFWLElBQUksQ0FBQ00sSUFBSSxHQUFHWSxNQUFNWixJQUFJO1lBQ2hDO1lBQ0EsT0FBT0k7UUFDVDtRQUVBLE1BQU1sQyxRQUFPLEVBQUV3QixJQUFJLEVBQUVzQixPQUFPLEVBQUU7WUFDNUIscUVBQXFFO1lBQ3JFLElBQUlBLFNBQVNDLGFBQWEsZUFBZTtnQkFDdkMsT0FBTztZQUNUO1lBRUEscUNBQXFDO1lBQ3JDLElBQUksQ0FBQ3ZCLE1BQU05QixPQUFPO2dCQUNoQixPQUFPO1lBQ1Q7WUFFQSxPQUFPO1FBQ1Q7SUFDRjtJQUVBc0QsUUFBUTtRQUNOLE1BQU1oRCxRQUFPLEVBQUV3QixJQUFJLEVBQUVzQixPQUFPLEVBQUVHLFNBQVMsRUFBRTtZQUN2Qyx1QkFBdUI7WUFDdkIsSUFBSXpCLEtBQUtkLEVBQUUsRUFBRTtnQkFDWCxNQUFNckIsbUNBQUVBLENBQUM2RCxRQUFRLENBQUNDLE1BQU0sQ0FBQztvQkFDdkI1QixNQUFNO3dCQUNKNkIsUUFBUTVCLEtBQUtkLEVBQUU7d0JBQ2ZJLE1BQU07d0JBQ051QyxhQUFhLENBQUMsbUJBQW1CLEVBQUVQLFNBQVNDLFlBQVksZUFBZTt3QkFDdkVPLFVBQVU7NEJBQ1JQLFVBQVVELFNBQVNDLFlBQVk7NEJBQy9CRTt3QkFDRjtvQkFDRjtnQkFDRixHQUFHTSxLQUFLLENBQUNwQyxRQUFRRSxLQUFLO1lBQ3hCO1FBQ0Y7UUFFQSxNQUFNbUMsWUFBVyxFQUFFaEMsSUFBSSxFQUFFO1lBQ3ZCLDJDQUEyQztZQUMzQyxJQUFJQSxLQUFLZCxFQUFFLEVBQUU7Z0JBQ1gsTUFBTXJCLG1DQUFFQSxDQUFDb0UsZUFBZSxDQUFDTixNQUFNLENBQUM7b0JBQzlCNUIsTUFBTTt3QkFDSjZCLFFBQVE1QixLQUFLZCxFQUFFO29CQUNqQjtnQkFDRixHQUFHNkMsS0FBSyxDQUFDcEMsUUFBUUUsS0FBSztZQUN4QjtRQUNGO0lBQ0Y7SUFFQXFDLFFBQVFyRCxRQUFRQyxHQUFHLENBQUNxRCxXQUFXO0lBQy9CQyxPQUFPdkQsa0JBQXlCO0FBQ2xDLEdBQUc7QUFFSCxtREFBbUQ7QUFFbkQ7O0NBRUMsR0FDTSxlQUFld0QsYUFBYWpFLFFBQWdCO0lBQ2pELE9BQU9MLHFEQUFXLENBQUNLLFVBQVU7QUFDL0I7QUFFQTs7Q0FFQyxHQUNNLGVBQWVtRSxlQUFlbkUsUUFBZ0IsRUFBRWtFLElBQVk7SUFDakUsT0FBT3ZFLHdEQUFjLENBQUNLLFVBQVVrRTtBQUNsQztBQUVBLDZDQUE2QztBQUU3Qzs7Q0FFQyxHQUNNLGVBQWVFO0lBQ3BCLE1BQU05QixVQUFVLE1BQU1uQztJQUN0QixPQUFPbUMsU0FBU1Y7QUFDbEI7QUFFQTs7Q0FFQyxHQUNNLGVBQWV5QztJQUNwQixNQUFNekMsT0FBTyxNQUFNd0M7SUFDbkIsSUFBSSxDQUFDeEMsTUFBTTtRQUNULE1BQU0sSUFBSTBDLE1BQU07SUFDbEI7SUFDQSxPQUFPMUM7QUFDVDtBQUVBOztDQUVDLEdBQ00sZUFBZTJDLFlBQVlDLEtBQWU7SUFDL0MsTUFBTTVDLE9BQU8sTUFBTXlDO0lBQ25CLElBQUksQ0FBQ0csTUFBTUMsUUFBUSxDQUFDN0MsS0FBS00sSUFBSSxJQUFJLEtBQUs7UUFDcEMsTUFBTSxJQUFJb0MsTUFBTTtJQUNsQjtJQUNBLE9BQU8xQztBQUNUO0FBRUE7O0NBRUMsR0FDTSxlQUFlOEM7SUFDcEIsT0FBT0gsWUFBWTtRQUFDO0tBQVE7QUFDOUIiLCJzb3VyY2VzIjpbIi9Vc2Vycy96YWsvRG9jdW1lbnRzL2xpdGxlbnMvc3JjL2xpYi9hdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBOZXh0QXV0aCBmcm9tIFwibmV4dC1hdXRoXCI7XG5pbXBvcnQgeyBQcmlzbWFBZGFwdGVyIH0gZnJvbSBcIkBhdXRoL3ByaXNtYS1hZGFwdGVyXCI7XG5pbXBvcnQgUmVzZW5kIGZyb20gXCJuZXh0LWF1dGgvcHJvdmlkZXJzL3Jlc2VuZFwiO1xuaW1wb3J0IENyZWRlbnRpYWxzIGZyb20gXCJuZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzXCI7XG5pbXBvcnQgeyBkYiB9IGZyb20gXCIuL2RiXCI7XG5pbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuaW1wb3J0IGJjcnlwdCBmcm9tIFwiYmNyeXB0anNcIjtcblxuLy8gQ3JlZGVudGlhbHMgdmFsaWRhdGlvbiBzY2hlbWFcbmNvbnN0IGNyZWRlbnRpYWxzU2NoZW1hID0gei5vYmplY3Qoe1xuICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbChcIkludmFsaWQgZW1haWwgYWRkcmVzc1wiKSxcbiAgcGFzc3dvcmQ6IHouc3RyaW5nKCkubWluKDgsIFwiUGFzc3dvcmQgbXVzdCBiZSBhdCBsZWFzdCA4IGNoYXJhY3RlcnNcIiksXG59KTtcblxuZXhwb3J0IGNvbnN0IHsgaGFuZGxlcnMsIGF1dGgsIHNpZ25Jbiwgc2lnbk91dCB9ID0gTmV4dEF1dGgoe1xuICBhZGFwdGVyOiBQcmlzbWFBZGFwdGVyKGRiKSxcbiAgXG4gIHByb3ZpZGVyczogW1xuICAgIC8vIE1hZ2ljIExpbmsgdmlhIFJlc2VuZFxuICAgIFJlc2VuZCh7XG4gICAgICBhcGlLZXk6IHByb2Nlc3MuZW52LlJFU0VORF9BUElfS0VZLFxuICAgICAgZnJvbTogcHJvY2Vzcy5lbnYuRlJPTV9FTUFJTCB8fCBcIkxpdExlbnMgPG5vcmVwbHlAbGl0bGVucy5jb20+XCIsXG4gICAgfSksXG4gICAgXG4gICAgLy8gRW1haWwvUGFzc3dvcmQgY3JlZGVudGlhbHNcbiAgICBDcmVkZW50aWFscyh7XG4gICAgICBpZDogXCJjcmVkZW50aWFsc1wiLFxuICAgICAgbmFtZTogXCJFbWFpbCAmIFBhc3N3b3JkXCIsXG4gICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICBlbWFpbDogeyBsYWJlbDogXCJFbWFpbFwiLCB0eXBlOiBcImVtYWlsXCIgfSxcbiAgICAgICAgcGFzc3dvcmQ6IHsgbGFiZWw6IFwiUGFzc3dvcmRcIiwgdHlwZTogXCJwYXNzd29yZFwiIH0sXG4gICAgICB9LFxuICAgICAgYXN5bmMgYXV0aG9yaXplKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcGFyc2VkID0gY3JlZGVudGlhbHNTY2hlbWEuc2FmZVBhcnNlKGNyZWRlbnRpYWxzKTtcbiAgICAgICAgICBpZiAoIXBhcnNlZC5zdWNjZXNzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIltBdXRoXSBJbnZhbGlkIGNyZWRlbnRpYWxzIGZvcm1hdDpcIiwgcGFyc2VkLmVycm9yLmVycm9ycyk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCB9ID0gcGFyc2VkLmRhdGE7XG5cbiAgICAgICAgICAvLyBGaW5kIHVzZXIgd2l0aCBwYXNzd29yZFxuICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSxcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGltYWdlOiB0cnVlLFxuICAgICAgICAgICAgICBwYXNzd29yZDogdHJ1ZSxcbiAgICAgICAgICAgICAgcm9sZTogdHJ1ZSxcbiAgICAgICAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBVc2VyIG5vdCBmb3VuZCBvciBubyBwYXNzd29yZCBzZXRcbiAgICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW0F1dGhdIFVzZXIgbm90IGZvdW5kOlwiLCBlbWFpbCk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKCF1c2VyLnBhc3N3b3JkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIltBdXRoXSBVc2VyIGhhcyBubyBwYXNzd29yZCBzZXQgKG1hZ2ljIGxpbmsgdXNlcik6XCIsIGVtYWlsKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFZlcmlmeSBwYXNzd29yZFxuICAgICAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgdXNlci5wYXNzd29yZCk7XG4gICAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIltBdXRoXSBJbnZhbGlkIHBhc3N3b3JkIGZvcjpcIiwgZW1haWwpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc29sZS5sb2coXCJbQXV0aF0gTG9naW4gc3VjY2Vzc2Z1bCBmb3I6XCIsIGVtYWlsKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBSZXR1cm4gdXNlciBkYXRhICh3aXRob3V0IHBhc3N3b3JkKVxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgbmFtZTogdXNlci5uYW1lLFxuICAgICAgICAgICAgaW1hZ2U6IHVzZXIuaW1hZ2UsXG4gICAgICAgICAgICByb2xlOiB1c2VyLnJvbGUsXG4gICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB1c2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiW0F1dGhdIEF1dGhvcml6YXRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KSxcbiAgXSxcbiAgXG4gIHNlc3Npb246IHtcbiAgICBzdHJhdGVneTogXCJqd3RcIixcbiAgICBtYXhBZ2U6IDMwICogMjQgKiA2MCAqIDYwLCAvLyAzMCBkYXlzXG4gIH0sXG4gIFxuICBwYWdlczoge1xuICAgIHNpZ25JbjogXCIvbG9naW5cIixcbiAgICBzaWduT3V0OiBcIi9sb2dpblwiLFxuICAgIGVycm9yOiBcIi9sb2dpblwiLFxuICAgIHZlcmlmeVJlcXVlc3Q6IFwiL3ZlcmlmeS1yZXF1ZXN0XCIsXG4gICAgbmV3VXNlcjogXCIvb25ib2FyZGluZ1wiLFxuICB9LFxuICBcbiAgY2FsbGJhY2tzOiB7XG4gICAgYXN5bmMgand0KHsgdG9rZW4sIHVzZXIsIHRyaWdnZXIsIHNlc3Npb24gfSkge1xuICAgICAgLy8gSW5pdGlhbCBzaWduIGluXG4gICAgICBpZiAodXNlcikge1xuICAgICAgICB0b2tlbi5pZCA9IHVzZXIuaWQ7XG4gICAgICAgIHRva2VuLnJvbGUgPSAodXNlciBhcyB7IHJvbGU/OiBzdHJpbmcgfSkucm9sZSB8fCBcIlVTRVJcIjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRmV0Y2ggZnJlc2ggdXNlciBkYXRhIG9uIHNlc3Npb24gdXBkYXRlXG4gICAgICBpZiAodHJpZ2dlciA9PT0gXCJ1cGRhdGVcIiAmJiBzZXNzaW9uKSB7XG4gICAgICAgIGNvbnN0IGZyZXNoVXNlciA9IGF3YWl0IGRiLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IHRva2VuLmlkIGFzIHN0cmluZyB9LFxuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICBpbWFnZTogdHJ1ZSxcbiAgICAgICAgICAgIHJvbGU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoZnJlc2hVc2VyKSB7XG4gICAgICAgICAgdG9rZW4ubmFtZSA9IGZyZXNoVXNlci5uYW1lO1xuICAgICAgICAgIHRva2VuLmVtYWlsID0gZnJlc2hVc2VyLmVtYWlsO1xuICAgICAgICAgIHRva2VuLnBpY3R1cmUgPSBmcmVzaFVzZXIuaW1hZ2U7XG4gICAgICAgICAgdG9rZW4ucm9sZSA9IGZyZXNoVXNlci5yb2xlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB0b2tlbjtcbiAgICB9LFxuICAgIFxuICAgIGFzeW5jIHNlc3Npb24oeyBzZXNzaW9uLCB0b2tlbiB9KSB7XG4gICAgICBpZiAodG9rZW4gJiYgc2Vzc2lvbi51c2VyKSB7XG4gICAgICAgIHNlc3Npb24udXNlci5pZCA9IHRva2VuLmlkIGFzIHN0cmluZztcbiAgICAgICAgc2Vzc2lvbi51c2VyLnJvbGUgPSB0b2tlbi5yb2xlIGFzIHN0cmluZztcbiAgICAgIH1cbiAgICAgIHJldHVybiBzZXNzaW9uO1xuICAgIH0sXG4gICAgXG4gICAgYXN5bmMgc2lnbkluKHsgdXNlciwgYWNjb3VudCB9KSB7XG4gICAgICAvLyBGb3IgY3JlZGVudGlhbHMgcHJvdmlkZXIsIGFsd2F5cyBhbGxvdyAocGFzc3dvcmQgYWxyZWFkeSB2ZXJpZmllZClcbiAgICAgIGlmIChhY2NvdW50Py5wcm92aWRlciA9PT0gXCJjcmVkZW50aWFsc1wiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBGb3IgbWFnaWMgbGluaywgY2hlY2sgZW1haWwgZXhpc3RzXG4gICAgICBpZiAoIXVzZXI/LmVtYWlsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgfSxcbiAgXG4gIGV2ZW50czoge1xuICAgIGFzeW5jIHNpZ25Jbih7IHVzZXIsIGFjY291bnQsIGlzTmV3VXNlciB9KSB7XG4gICAgICAvLyBMb2cgc2lnbiBpbiBhY3Rpdml0eVxuICAgICAgaWYgKHVzZXIuaWQpIHtcbiAgICAgICAgYXdhaXQgZGIuYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICAgICAgICB0eXBlOiBcIlBST0pFQ1RfQ1JFQVRFRFwiLCAvLyBVc2luZyBleGlzdGluZyBlbnVtXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYFVzZXIgc2lnbmVkIGluIHZpYSAke2FjY291bnQ/LnByb3ZpZGVyIHx8IFwiY3JlZGVudGlhbHNcIn1gLFxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgcHJvdmlkZXI6IGFjY291bnQ/LnByb3ZpZGVyIHx8IFwiY3JlZGVudGlhbHNcIixcbiAgICAgICAgICAgICAgaXNOZXdVc2VyLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIGFzeW5jIGNyZWF0ZVVzZXIoeyB1c2VyIH0pIHtcbiAgICAgIC8vIENyZWF0ZSBkZWZhdWx0IHByZWZlcmVuY2VzIGZvciBuZXcgdXNlcnNcbiAgICAgIGlmICh1c2VyLmlkKSB7XG4gICAgICAgIGF3YWl0IGRiLnVzZXJQcmVmZXJlbmNlcy5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9KS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuICBcbiAgc2VjcmV0OiBwcm9jZXNzLmVudi5BVVRIX1NFQ1JFVCxcbiAgZGVidWc6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcImRldmVsb3BtZW50XCIsXG59KTtcblxuLy8gPT09PT09PT09PT09PT0gUEFTU1dPUkQgVVRJTElUSUVTID09PT09PT09PT09PT09XG5cbi8qKlxuICogSGFzaCBhIHBhc3N3b3JkIHVzaW5nIGJjcnlwdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFzaFBhc3N3b3JkKHBhc3N3b3JkOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICByZXR1cm4gYmNyeXB0Lmhhc2gocGFzc3dvcmQsIDEyKTtcbn1cblxuLyoqXG4gKiBWZXJpZnkgYSBwYXNzd29yZCBhZ2FpbnN0IGEgaGFzaFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5UGFzc3dvcmQocGFzc3dvcmQ6IHN0cmluZywgaGFzaDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHJldHVybiBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgaGFzaCk7XG59XG5cbi8vID09PT09PT09PT09PT09IEFVVEggSEVMUEVSUyA9PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCBjdXJyZW50IHNlc3Npb24gKGZvciBzZXJ2ZXIgY29tcG9uZW50cylcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VyKCkge1xuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aCgpO1xuICByZXR1cm4gc2Vzc2lvbj8udXNlcjtcbn1cblxuLyoqXG4gKiBSZXF1aXJlIGF1dGhlbnRpY2F0aW9uICh0aHJvd3MgaWYgbm90IGF1dGhlbnRpY2F0ZWQpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXF1aXJlQXV0aCgpIHtcbiAgY29uc3QgdXNlciA9IGF3YWl0IGdldEN1cnJlbnRVc2VyKCk7XG4gIGlmICghdXNlcikge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlVuYXV0aG9yaXplZFwiKTtcbiAgfVxuICByZXR1cm4gdXNlcjtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGhhcyBhIHNwZWNpZmljIHJvbGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlcXVpcmVSb2xlKHJvbGVzOiBzdHJpbmdbXSkge1xuICBjb25zdCB1c2VyID0gYXdhaXQgcmVxdWlyZUF1dGgoKTtcbiAgaWYgKCFyb2xlcy5pbmNsdWRlcyh1c2VyLnJvbGUgfHwgXCJcIikpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJGb3JiaWRkZW5cIik7XG4gIH1cbiAgcmV0dXJuIHVzZXI7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdXNlciBpcyBhZG1pblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVxdWlyZUFkbWluKCkge1xuICByZXR1cm4gcmVxdWlyZVJvbGUoW1wiQURNSU5cIl0pO1xufVxuXG4vLyA9PT09PT09PT09PT09PSBUWVBFIEFVR01FTlRBVElPTiA9PT09PT09PT09PT09PVxuXG5kZWNsYXJlIG1vZHVsZSBcIm5leHQtYXV0aFwiIHtcbiAgaW50ZXJmYWNlIFNlc3Npb24ge1xuICAgIHVzZXI6IHtcbiAgICAgIGlkOiBzdHJpbmc7XG4gICAgICBuYW1lPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgIGVtYWlsPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgIGltYWdlPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgIHJvbGU/OiBzdHJpbmc7XG4gICAgfTtcbiAgfVxuICBcbiAgaW50ZXJmYWNlIFVzZXIge1xuICAgIHJvbGU/OiBzdHJpbmc7XG4gICAgZW1haWxWZXJpZmllZD86IERhdGUgfCBudWxsO1xuICB9XG59XG5cbmRlY2xhcmUgbW9kdWxlIFwiQGF1dGgvY29yZS9qd3RcIiB7XG4gIGludGVyZmFjZSBKV1Qge1xuICAgIGlkPzogc3RyaW5nO1xuICAgIHJvbGU/OiBzdHJpbmc7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0QXV0aCIsIlByaXNtYUFkYXB0ZXIiLCJSZXNlbmQiLCJDcmVkZW50aWFscyIsImRiIiwieiIsImJjcnlwdCIsImNyZWRlbnRpYWxzU2NoZW1hIiwib2JqZWN0IiwiZW1haWwiLCJzdHJpbmciLCJwYXNzd29yZCIsIm1pbiIsImhhbmRsZXJzIiwiYXV0aCIsInNpZ25JbiIsInNpZ25PdXQiLCJhZGFwdGVyIiwicHJvdmlkZXJzIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIlJFU0VORF9BUElfS0VZIiwiZnJvbSIsIkZST01fRU1BSUwiLCJpZCIsIm5hbWUiLCJjcmVkZW50aWFscyIsImxhYmVsIiwidHlwZSIsImF1dGhvcml6ZSIsInBhcnNlZCIsInNhZmVQYXJzZSIsInN1Y2Nlc3MiLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJlcnJvcnMiLCJkYXRhIiwidXNlciIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsInRvTG93ZXJDYXNlIiwic2VsZWN0IiwiaW1hZ2UiLCJyb2xlIiwiZW1haWxWZXJpZmllZCIsImlzVmFsaWQiLCJjb21wYXJlIiwic2Vzc2lvbiIsInN0cmF0ZWd5IiwibWF4QWdlIiwicGFnZXMiLCJ2ZXJpZnlSZXF1ZXN0IiwibmV3VXNlciIsImNhbGxiYWNrcyIsImp3dCIsInRva2VuIiwidHJpZ2dlciIsImZyZXNoVXNlciIsInBpY3R1cmUiLCJhY2NvdW50IiwicHJvdmlkZXIiLCJldmVudHMiLCJpc05ld1VzZXIiLCJhY3Rpdml0eSIsImNyZWF0ZSIsInVzZXJJZCIsImRlc2NyaXB0aW9uIiwibWV0YWRhdGEiLCJjYXRjaCIsImNyZWF0ZVVzZXIiLCJ1c2VyUHJlZmVyZW5jZXMiLCJzZWNyZXQiLCJBVVRIX1NFQ1JFVCIsImRlYnVnIiwiaGFzaFBhc3N3b3JkIiwiaGFzaCIsInZlcmlmeVBhc3N3b3JkIiwiZ2V0Q3VycmVudFVzZXIiLCJyZXF1aXJlQXV0aCIsIkVycm9yIiwicmVxdWlyZVJvbGUiLCJyb2xlcyIsImluY2x1ZGVzIiwicmVxdWlyZUFkbWluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./src/lib/auth.ts\n");

/***/ })

});